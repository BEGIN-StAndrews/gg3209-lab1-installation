name: Lab 1 Validation

on: [push]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v2

    - name: 🐍 Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: 📦 Install Python dependencies
      run: |
        pip install jupyter nbconvert pandas numpy matplotlib geopandas folium nbformat

    - name: 📁 Check required files (basic validation)
      run: |
        echo "🔍 Checking for required files..."
        test -f my_first_notebook.ipynb || { echo "❌ Notebook missing"; exit 1; }
        test -f my_first_notebook.pdf || { echo "❌ PDF missing"; exit 1; }
        test -f screenshot_1_installation_check.png || { echo "❌ screenshot_1_installation_check.png missing"; exit 1; }
        test -f screenshot_2_jupyter_home.png || { echo "❌ screenshot_2_jupyter_home.png missing"; exit 1; }
        test -f screenshot_3_notebook_complete.png || { echo "❌ screenshot_3_notebook_complete.png missing"; exit 1; }
        echo "✅ All required files are present"

    - name: ⚙️ Test notebook execution (quick check)
      run: |
        echo "🚀 Executing notebook to ensure it runs..."
        jupyter nbconvert --to notebook --execute my_first_notebook.ipynb --output executed_notebook.ipynb
        echo "✅ Notebook ran successfully"

    - name: 🔐 Check anti-AI verification elements
      run: |
        echo "🛡️ Verifying presence of student ID elements..."
        grep -q "datetime.datetime.now()" my_first_notebook.ipynb || { echo "❌ Timestamp code missing"; exit 1; }
        grep -q "platform.node()" my_first_notebook.ipynb || { echo "❌ Computer name code missing"; exit 1; }
        echo "✅ Verification elements are present"

    - name: 🧪 Run point-based autograder (optional but useful)
      run: |
        echo "📊 Running test.py for score breakdown..."
        python test_assignment.py || echo "⚠️ Autograder ran with issues (check output)."

    - name: ✅ All checks passed
      run: echo "🎉 Lab 1-Installation validation passed!"
